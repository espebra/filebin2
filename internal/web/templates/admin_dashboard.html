{{ define "admin_dashboard" }}<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <link rel="icon" href="/static/img/favicon.png">
        <link rel="stylesheet" href="/static/css/bootstrap.min.css"/>
        <link rel="stylesheet" href="/static/css/fontawesome.all.min.css"/>
        <link rel="stylesheet" href="/static/css/custom.css"/>
        <script src="/static/js/sorttable.js"></script>

        <link rel="stylesheet" href="/static/css/Chart.min.css"/>
        <script src="/static/js/Chart.min.js"></script>

        <title>Filebin | Dashboard</title>
    </head>
    <body class="container-fluid">

        {{template "admin_bar" .}}

        <h1>Dashboard</h1>

        <h2>Uptime</h2>
        <table class="table table-sm">
            <tr>
                <th>Started at</th>
                <td>{{ .StartedAt.Format "2006-01-02 15:04:05 UTC" }}</td>
            </tr>
            <tr>
                <th>Uptime</th>
                <td>{{ .UptimeReadable }}</td>
            </tr>
        </table>

        <h2>Admin logins</h2>
        {{ $numAdminLogins := .AdminLogins | len }}
        {{ if eq $numAdminLogins 0 }}
            <p>No admin logins recorded yet.</p>
        {{ else }}
        <table class="sortable table table-sm table-hover">
            <thead>
                <tr>
                    <th>IP</th>
                    <th>Hostname</th>
                    <th>Last active</th>
                    <th>Last active (readable)</th>
                </tr>
            </thead>
            <tbody>
                {{ range $index, $value := .AdminLogins }}
                <tr>
                    <td>{{ .IP }}</td>
                    <td>{{ if .Hostname }}{{ .Hostname }}{{ else }}-{{ end }}</td>
                    <td sorttable_customkey="{{ .LastActive }}">{{ .LastActive.Format "2006-01-02 15:04:05 UTC" }}</td>
                    <td>{{ .LastActiveReadable }}</td>
                </tr>
                {{ end }}
            </tbody>
        </table>
        {{ end }}

        <h2>Storage capacity</h2>
        {{ if gt .StorageMetrics.TotalBytes 0 }}
        <table class="table table-sm">
            <tr>
                <th>Used</th>
                <td>{{ .StorageMetrics.UsedBytesReadable }} ({{ .StorageMetrics.UsedBytes }} bytes)</td>
            </tr>
            <tr>
                <th>Total</th>
                <td>{{ .StorageMetrics.TotalBytesReadable }} ({{ .StorageMetrics.TotalBytes }} bytes)</td>
            </tr>
            <tr>
                <th>Free</th>
                <td>{{ .StorageMetrics.FreeBytesReadable }} ({{ .StorageMetrics.FreeBytes }} bytes)</td>
            </tr>
            <tr>
                <th>Usage</th>
                <td>
                    {{ $pct := .StorageMetrics.UsedPercent }}
                    <div class="progress" style="height: 25px;">
                        {{ if lt $pct 70.0 }}
                            <div class="progress-bar bg-success" role="progressbar" style="width: {{ printf "%.1f" $pct }}%;" aria-valuenow="{{ printf "%.1f" $pct }}" aria-valuemin="0" aria-valuemax="100">{{ printf "%.1f%%" $pct }}</div>
                        {{ else if lt $pct 90.0 }}
                            <div class="progress-bar bg-warning" role="progressbar" style="width: {{ printf "%.1f" $pct }}%;" aria-valuenow="{{ printf "%.1f" $pct }}" aria-valuemin="0" aria-valuemax="100">{{ printf "%.1f%%" $pct }}</div>
                        {{ else }}
                            <div class="progress-bar bg-danger" role="progressbar" style="width: {{ printf "%.1f" $pct }}%;" aria-valuenow="{{ printf "%.1f" $pct }}" aria-valuemin="0" aria-valuemax="100">{{ printf "%.1f%%" $pct }}</div>
                        {{ end }}
                    </div>
                </td>
            </tr>
        </table>
        {{ else }}
        <p>No storage limit configured. Current usage: {{ .StorageMetrics.UsedBytesReadable }} ({{ .StorageMetrics.UsedBytes }} bytes)</p>
        {{ end }}

        <h2>Database connection pool</h2>
        <ul>
            <li>Maximum number of open connections to the database: {{ .DBStats.MaxOpenConnections}}</li>
            <li>The number of established connections both in use and idle: {{ .DBStats.OpenConnections}}</li>
            <li>The number of connections currently in use: {{ .DBStats.InUse}}</li>
            <li>The number of idle connections: {{ .DBStats.Idle}}</li>
            <li>The total number of connections waited for: {{ .DBStats.WaitCount}}</li>
            <li>The total time blocked waiting for a new connection: {{ .DBStats.WaitDuration}}</li>
            <li>The total number of connections closed due to SetMaxIdleConns: {{ .DBStats.MaxIdleClosed}}</li>
            <li>The total number of connections closed due to SetConnMaxIdleTime: {{ .DBStats.MaxIdleTimeClosed}}</li>
            <li>The total number of connections closed due to SetConnMaxLifetime: {{ .DBStats.MaxLifetimeClosed}}</li>
        </ul>

        <script src="/static/js/popper.min.js"></script>
        <script src="/static/js/bootstrap.min.js"></script>
    </body>
</html>
{{ end }}
